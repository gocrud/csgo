# æ¶æ„è®¾è®¡æ–‡æ¡£

## ğŸ—ï¸ æ¶æ„æ¦‚è§ˆ

æœ¬é¡¹ç›®é‡‡ç”¨ **å‚ç›´åˆ‡ç‰‡æ¶æ„ï¼ˆVertical Slice Architectureï¼‰+ å¤šç«¯éš”ç¦»** çš„è®¾è®¡æ¨¡å¼ã€‚

## ğŸ“ è®¾è®¡åŸåˆ™

### 1. å‚ç›´åˆ‡ç‰‡ä¼˜å…ˆ

æ¯ä¸ªåŠŸèƒ½æ˜¯ä¸€ä¸ªå®Œæ•´çš„å‚ç›´åˆ‡ç‰‡ï¼Œä» HTTP å±‚åˆ°æ•°æ®è®¿é—®å±‚éƒ½åœ¨ä¸€ä¸ªç›®å½•å†…ã€‚

**ä¼˜åŠ¿ï¼š**
- é«˜å†…èšï¼šç›¸å…³ä»£ç èšé›†åœ¨ä¸€èµ·
- æ˜“ç»´æŠ¤ï¼šæ”¹åŠ¨èŒƒå›´å°ï¼Œå½±å“å¯æ§
- æ˜“æµ‹è¯•ï¼šå¯ä»¥é’ˆå¯¹å•ä¸ªåˆ‡ç‰‡ç¼–å†™æµ‹è¯•
- æ˜“æ‰©å±•ï¼šæ–°å¢åŠŸèƒ½åªéœ€æ·»åŠ æ–°åˆ‡ç‰‡

**ç¤ºä¾‹ï¼š**
```
apps/admin/features/users/
â”œâ”€â”€ create_user.go        # åŒ…å«ï¼šè¯·æ±‚ã€éªŒè¯ã€ä¸šåŠ¡é€»è¾‘ã€æ•°æ®æŒä¹…åŒ–
â”œâ”€â”€ list_users.go         # å®Œæ•´çš„åˆ—è¡¨åŠŸèƒ½
â”œâ”€â”€ update_user.go        # å®Œæ•´çš„æ›´æ–°åŠŸèƒ½
â”œâ”€â”€ controller.go         # HTTP è·¯ç”±å’Œæ§åˆ¶
â””â”€â”€ service_extensions.go # DI æ³¨å†Œ
```

### 2. å¤šç«¯éš”ç¦»

ä¸åŒçš„å®¢æˆ·ç«¯ï¼ˆç®¡ç†ç«¯ã€Cç«¯ã€Workerï¼‰å®Œå…¨ç‹¬ç«‹ã€‚

**æ¶æ„å›¾ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Entry Points                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  cmd/admin  â”‚    cmd/api      â”‚       cmd/worker            â”‚
â”‚   (8081)    â”‚    (8080)       â”‚        (jobs)               â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                â”‚                   â”‚
      â–¼                â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  apps/admin  â”‚ â”‚   apps/api   â”‚ â”‚ apps/worker  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ features/    â”‚ â”‚ features/    â”‚ â”‚ jobs/        â”‚
â”‚ - users      â”‚ â”‚ - auth       â”‚ â”‚ - order_sync â”‚
â”‚ - products   â”‚ â”‚ - products   â”‚ â”‚ - email      â”‚
â”‚ - dashboard  â”‚ â”‚ - orders     â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
       â”‚                â”‚                â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚      shared/     â”‚
              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
              â”‚ - domain         â”‚
              â”‚ - repositories   â”‚
              â”‚ - infrastructure â”‚
              â”‚ - utils          â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¼˜åŠ¿ï¼š**
- å®‰å…¨éš”ç¦»ï¼šä¸åŒç«¯çš„ä»£ç äº’ä¸å½±å“
- ç‹¬ç«‹éƒ¨ç½²ï¼šå¯ä»¥å•ç‹¬éƒ¨ç½²å’Œæ‰©å®¹
- æƒé™åˆ†ç¦»ï¼šä¸åŒç«¯æœ‰ä¸åŒçš„ä¸­é—´ä»¶å’Œæƒé™æ§åˆ¶

### 3. å…±äº«å±‚è®¾è®¡

åªæœ‰çœŸæ­£éœ€è¦å…±äº«çš„éƒ¨åˆ†æ‰æ”¾å…¥ `shared/`ã€‚

**å…±äº«å±‚å†…å®¹ï¼š**

```
shared/
â”œâ”€â”€ domain/              # é¢†åŸŸæ¨¡å‹ï¼ˆä½†ä¸æ˜¯ DDDï¼ï¼‰
â”‚   â”œâ”€â”€ user.go         # User å®ä½“
â”‚   â”œâ”€â”€ product.go      # Product å®ä½“
â”‚   â””â”€â”€ order.go        # Order å®ä½“
â”‚
â”œâ”€â”€ contracts/          # æ¥å£å¥‘çº¦
â”‚   â””â”€â”€ repositories/   # ä»“å‚¨æ¥å£
â”‚
â”œâ”€â”€ repositories/       # ä»“å‚¨å®ç°
â”‚   â”œâ”€â”€ user_repository_impl.go
â”‚   â”œâ”€â”€ product_repository_impl.go
â”‚   â””â”€â”€ order_repository_impl.go
â”‚
â”œâ”€â”€ infrastructure/     # åŸºç¡€è®¾æ–½
â”‚   â”œâ”€â”€ database/       # æ•°æ®åº“è¿æ¥
â”‚   â””â”€â”€ cache/          # ç¼“å­˜å®¢æˆ·ç«¯
â”‚
â””â”€â”€ utils/             # å·¥å…·å‡½æ•°
    â”œâ”€â”€ jwt.go
    â””â”€â”€ hash.go
```

## ğŸ”„ æ•°æ®æµ

### 1. HTTP è¯·æ±‚æµï¼ˆç®¡ç†ç«¯ç¤ºä¾‹ï¼‰

```
HTTP Request
    â”‚
    â–¼
Controller (controller.go)
    â”‚
    â–¼
Handler (create_user.go)
    â”‚
    â”œâ”€â†’ è¯·æ±‚éªŒè¯ (binding)
    â”‚
    â”œâ”€â†’ ä¸šåŠ¡éªŒè¯ (ExistsByEmail)
    â”‚
    â”œâ”€â†’ åˆ›å»ºå®ä½“ (domain.User)
    â”‚
    â””â”€â†’ æŒä¹…åŒ– (userRepo.Create)
         â”‚
         â–¼
      Repository (shared/repositories)
         â”‚
         â–¼
      Database (shared/infrastructure)
```

### 2. ä¾èµ–æ³¨å…¥æµ

```
main.go
    â”‚
    â–¼
Bootstrap()
    â”‚
    â”œâ”€â†’ æ³¨å†ŒåŸºç¡€è®¾æ–½
    â”‚   â””â”€â†’ database.AddDatabase()
    â”‚   â””â”€â†’ cache.AddCache()
    â”‚
    â”œâ”€â†’ æ³¨å†Œä»“å‚¨
    â”‚   â””â”€â†’ repositories.AddRepositories()
    â”‚
    â””â”€â†’ æ³¨å†ŒåŠŸèƒ½åˆ‡ç‰‡
        â””â”€â†’ users.AddUserFeature()
            â”œâ”€â†’ NewCreateUserHandler
            â”œâ”€â†’ NewListUsersHandler
            â””â”€â†’ NewUserController
```

## ğŸ¯ åŠŸèƒ½åˆ‡ç‰‡è¯¦è§£

### åŠŸèƒ½åˆ‡ç‰‡çš„ç»“æ„

æ¯ä¸ªåŠŸèƒ½åˆ‡ç‰‡éµå¾ªä»¥ä¸‹æ¨¡å¼ï¼š

```go
// 1. Handler - å¤„ç†å•ä¸ªæ“ä½œ
type CreateUserHandler struct {
    userRepo repositories.IUserRepository
}

// 2. Request/Response - è¯·æ±‚å’Œå“åº”æ¨¡å‹
type CreateUserRequest struct {
    Name     string `json:"name" binding:"required"`
    Email    string `json:"email" binding:"required,email"`
    Password string `json:"password" binding:"required,min=8"`
    Role     string `json:"role" binding:"required,oneof=admin user"`
}

// 3. Handle æ–¹æ³• - å®Œæ•´çš„ä¸šåŠ¡é€»è¾‘
func (h *CreateUserHandler) Handle(c *web.HttpContext) web.IActionResult {
    // éªŒè¯ã€ä¸šåŠ¡é€»è¾‘ã€æŒä¹…åŒ–
}

// 4. Controller - è·¯ç”±æ˜ å°„
type UserController struct {
    createHandler *CreateUserHandler
    listHandler   *ListUsersHandler
}

func (ctrl *UserController) MapRoutes(app *web.WebApplication) {
    users := app.MapGroup("/api/admin/users")
    users.MapPost("", ctrl.createHandler.Handle)
    users.MapGet("", ctrl.listHandler.Handle)
}

// 5. DI æ³¨å†Œ
func AddUserFeature(services di.IServiceCollection) {
    services.AddSingleton(NewCreateUserHandler)
    services.AddSingleton(NewListUsersHandler)
    web.AddController(services, NewUserController)
}
```

## ğŸ” å®‰å…¨è¾¹ç•Œ

### 1. ç®¡ç†ç«¯

- é€šè¿‡ `AdminAuthMiddleware` éªŒè¯ç®¡ç†å‘˜æƒé™
- å¯ä»¥æ‰§è¡Œæ‰€æœ‰æ“ä½œï¼ˆCRUDï¼‰
- å¯ä»¥æŸ¥çœ‹æ‰€æœ‰çŠ¶æ€çš„æ•°æ®

### 2. C ç«¯

- é€šè¿‡ `UserAuthMiddleware` éªŒè¯ç”¨æˆ·èº«ä»½
- åªèƒ½è®¿é—®å…¬å¼€æ¥å£å’Œè‡ªå·±çš„æ•°æ®
- åªèƒ½æŸ¥çœ‹ active çŠ¶æ€çš„å•†å“

### 3. Worker

- æ—  HTTP æ¥å£
- é€šè¿‡åå°ä»»åŠ¡æ‰§è¡Œå®šæ—¶æ“ä½œ
- ç›´æ¥è®¿é—®å…±äº«å±‚çš„æœåŠ¡

## ğŸ“Š æ‰©å±•æ€§è®¾è®¡

### 1. æ·»åŠ æ–°åŠŸèƒ½

åœ¨å¯¹åº”ç«¯çš„ `features/` ç›®å½•ä¸‹åˆ›å»ºæ–°ç›®å½•ï¼š

```bash
apps/admin/features/
â””â”€â”€ reports/              # æ–°åŠŸèƒ½ï¼šæŠ¥è¡¨
    â”œâ”€â”€ generate_report.go
    â”œâ”€â”€ export_report.go
    â”œâ”€â”€ controller.go
    â””â”€â”€ service_extensions.go
```

ç„¶ååœ¨ `bootstrap.go` ä¸­æ³¨å†Œï¼š

```go
reports.AddReportFeature(builder.Services)
```

### 2. æ·»åŠ æ–°çš„ç«¯

åˆ›å»ºæ–°çš„å…¥å£å’Œåº”ç”¨ç›®å½•ï¼š

```bash
cmd/mobile/              # ç§»åŠ¨ç«¯å…¥å£
apps/mobile/             # ç§»åŠ¨ç«¯ä¸šåŠ¡é€»è¾‘
```

### 3. æ·»åŠ å…±äº«æœåŠ¡

åœ¨ `shared/services/` ä¸­åˆ›å»ºæ–°æœåŠ¡ï¼š

```bash
shared/services/sms/
â”œâ”€â”€ sms_service.go
â””â”€â”€ service_extensions.go
```

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### 1. å•å…ƒæµ‹è¯•

é’ˆå¯¹æ¯ä¸ª Handler ç¼–å†™å•å…ƒæµ‹è¯•ï¼š

```go
func TestCreateUserHandler_Handle(t *testing.T) {
    // Mock repository
    mockRepo := &MockUserRepository{}
    handler := NewCreateUserHandler(mockRepo)
    
    // Test logic
}
```

### 2. é›†æˆæµ‹è¯•

é’ˆå¯¹æ•´ä¸ªåŠŸèƒ½åˆ‡ç‰‡ç¼–å†™é›†æˆæµ‹è¯•ã€‚

### 3. ç«¯åˆ°ç«¯æµ‹è¯•

é’ˆå¯¹æ¯ä¸ªç«¯çš„å®Œæ•´æµç¨‹ç¼–å†™ E2E æµ‹è¯•ã€‚

## ğŸš€ éƒ¨ç½²æ¶æ„

### å¼€å‘ç¯å¢ƒ

æ‰€æœ‰ç«¯è¿è¡Œåœ¨åŒä¸€å°æœºå™¨ï¼š
```
localhost:8080 - Cç«¯
localhost:8081 - ç®¡ç†ç«¯
localhost:8082 - Worker
```

### ç”Ÿäº§ç¯å¢ƒ

å„ç«¯ç‹¬ç«‹éƒ¨ç½²ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Load Balancer    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
     â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
     â”‚           â”‚
â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
â”‚ Admin   â”‚ â”‚  API    â”‚
â”‚ Server  â”‚ â”‚ Server  â”‚
â”‚ (å¤šå®ä¾‹) â”‚ â”‚ (å¤šå®ä¾‹) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Worker Cluster     â”‚
â”‚  (K8s CronJob)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ è®¾è®¡å†³ç­–

### ä¸ºä»€ä¹ˆé€‰æ‹©å‚ç›´åˆ‡ç‰‡è€Œéåˆ†å±‚æ¶æ„ï¼Ÿ

| è€ƒè™‘å› ç´  | åˆ†å±‚æ¶æ„ | å‚ç›´åˆ‡ç‰‡ |
|---------|---------|---------|
| ä»£ç æ”¹åŠ¨èŒƒå›´ | è·¨å¤šå±‚ | å•ä¸€ç›®å½• |
| åŠŸèƒ½ç‹¬ç«‹æ€§ | ä½ | é«˜ |
| å›¢é˜Ÿåä½œ | æ˜“å†²çª | æ˜“å¹¶è¡Œ |
| å­¦ä¹ æ›²çº¿ | å¹³ç¼“ | ä¸­ç­‰ |

### ä¸ºä»€ä¹ˆå¤šç«¯éš”ç¦»ï¼Ÿ

1. **å®‰å…¨éœ€æ±‚**ï¼šç®¡ç†ç«¯å’ŒCç«¯éœ€è¦ä¸åŒçš„æƒé™æ§åˆ¶
2. **æ‰©å±•éœ€æ±‚**ï¼šä¸åŒç«¯å¯èƒ½éœ€è¦ç‹¬ç«‹æ‰©å®¹
3. **æ¼”è¿›éœ€æ±‚**ï¼šä¸åŒç«¯çš„æ¼”è¿›é€Ÿåº¦å¯èƒ½ä¸åŒ

### ä¸ºä»€ä¹ˆä¸ç”¨ DDDï¼Ÿ

DDD é€‚åˆå¤æ‚çš„ä¸šåŠ¡è§„åˆ™ï¼Œä½†å­¦ä¹ æˆæœ¬é«˜ã€‚å‚ç›´åˆ‡ç‰‡æ¶æ„ï¼š
- æ›´ç®€å•æ˜“æ‡‚
- æ›´é€‚åˆå¿«é€Ÿè¿­ä»£
- ä¿ç•™äº†è¶³å¤Ÿçš„çµæ´»æ€§

## ğŸ“š å‚è€ƒèµ„æº

- [Vertical Slice Architecture](https://www.jimmybogard.com/vertical-slice-architecture/)
- [csgo æ¡†æ¶æ–‡æ¡£](../../README.md)

---

**è¿™ä¸ªæ¶æ„åœ¨ç®€å•æ€§å’Œçµæ´»æ€§ä¹‹é—´å–å¾—äº†å¾ˆå¥½çš„å¹³è¡¡ï¼** âš–ï¸

